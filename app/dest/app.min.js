!function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};c.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},c.window=function(){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||-1!=a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||"BackCompat"==d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"==d&&(d=9e9),f=a.extend({},c.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this._scrollable().each(function(){function g(a){j.animate(l,e,f.easing,a&&function(){a.call(this,d,f)})}if(null!=d){var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=b(k);break}if(k=a(k,this),!k.length)return;case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}a.each(f.axis.split(""),function(a,b){var d="x"==b?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=i[n],p=c.max(i,b);if(h)l[n]=h[e]+(m?0:o-j.offset()[e]),f.margin&&(l[n]-=parseInt(k.css("margin"+d))||0,l[n]-=parseInt(k.css("border"+d+"Width"))||0),l[n]+=f.offset[e]||0,f.over[e]&&(l[n]+=k["x"==b?"width":"height"]()*f.over[e]);else{var q=k[e];l[n]=q.slice&&"%"==q.slice(-1)?parseFloat(q)/100*p:q}f.limit&&/^\d+$/.test(l[n])&&(l[n]=l[n]<=0?0:Math.min(l[n],p)),!a&&f.queue&&(o!=l[n]&&g(f.onAfterFirst),delete l[n])}),g(f.onAfter)}}).end()},c.max=function(b,c){var d="x"==c?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery),function(a){Function.prototype.curry=Function.prototype.curry||function(){var a=this,b=Array.prototype.slice.call(arguments);return function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments)))}};var b=a.nextsepta={};b.noop=function(){}}(window),function(a){var b=a.nextsepta;b.__controller=function(a,c,d){if(c){if(a in d)throw new Error("Controller "+a+" already exists.");var e,f=[];return c.forEach?c.forEach(function(a){if("string"==typeof a)f.push(a);else if("function"==typeof a)return e=a,!1}):"function"==typeof c&&(e=c),d[a]={name:a,dependencies:f,constructor:e},b}return d[a]}}(window),function(a){function b(a,b){var e=this,f=c.noop,g={},h={};e.CLASS="Module",e.name=a,e.dependencies=b,e.loaded=!1,e.config=function(a){return"function"==typeof a&&(f=a),e},e.dependency=function(a){var b;return a in h?b=h[a]:e.dependencies.some(function(c){return b=d[c].dependency(a),!!b}),b},e.run=function(){e.loaded||(e.config(),e.dependencies.forEach(function(a){if(!(a in d))throw new Error("Module "+a+" doesn't exist.");d[a].run()}),e.loaded=!0,$(function(){e.$elem=$("[module="+e.name+"]"),e.parse("body"),e.dependency("content_settings").parse($(".js-content").html())}))},e.service=function(a,b){if(a in h)throw new Error("A dependency named "+a+" already exists.");var d=c.__service(a,b),f=[];return d.dependencies.forEach(function(a){"module"===a?f.push(e):f.push(e.dependency(a))}),h[a]=d.constructor.apply(d,f),e},e.controller=function(a,b){return b?(c.__controller(a,b,g),e):g[a]},e.on=function(a,b){$(e).bind(a,b)},e.emit=function(a,b){$(e).trigger(a,b)},e.parse=function(a){c.__parse(e,a)};var i={};e.data=function(a,b){return"undefined"==typeof b?i[a]:(i[a]=b,void 0)}}var c=a.nextsepta,d={};c.module=function(a,c){return c=c||[],a in d||(d[a]=new b(a,c)),d[a]}}(window),function(a){var b=a.nextsepta;b.__parse=function(a,b){var c=$(b,a.$elem),d=c.parent();$("[ctrl]",d).each(function(){var b=$(this);if(!b.data("nextsepta-ctrl")){var c=b.attr("ctrl"),d=a.controller(c);if(d){b.data("nextsepta-ctrl",d);var e=[];d.dependencies.forEach(function(c){"$elem"===c?e.push(b):"module"===c?e.push(a):e.push(a.dependency(c))}),d.constructor.apply(d,e)}}})}}(window),function(a){var b=a.nextsepta;b.__service=function(a,b){var c,d=[];return b.forEach?b.forEach(function(a){if("string"==typeof a)d.push(a);else if("function"==typeof a)return c=a,!1}):"function"==typeof b&&(c=b),{name:a,dependencies:d,constructor:c}}}(window),nextsepta.module("nextsepta").service("resize",[function(){function a(){f={mobile:e<=c.mobile.max,tablet:e>=c.tablet.min&&e<=c.tablet.max,desktop:e>=c.desktop.min}}function b(a){return a in c?f[a]:void 0}var c={mobile:{min:0,max:520},tablet:{min:521,max:960},desktop:{min:961,max:99999}},d=$(window).height(),e=$(window).width(),f={mobile:!0,tablet:!1,desktop:!1};return $(window).resize(function(){d=$(window).height(),e=$(window).width(),a()}),a(),{height:function(){return d},width:function(){return e},is:b,is_mobile:b.curry("mobile"),is_tablet:b.curry("tablet"),is_desktop:b.curry("desktop")}}]),nextsepta.module("nextsepta").service("content_settings",["module",function(a){function b(b,c){var d={title:"",back:!0,options:!0,footer:!0,map:!1,map_locate:!1,map_vehicle:null,route_type:null,route_id:null,has_realtime:!1,all_trips:!1},e=b.match(/<!-- (.+) -->/i);if(b.match(/<!-- (title: ([\w\|\- ]+));? ?(back: ?([\w]+))?;? ?(options: ?([\w]+))?;? ?(footer: ?([\w]+))?;? -->/i),e){var f=e[1].match(/((\w)+: ?([^;]+))/gi);f&&f.forEach(function(a){var b=a.split(/: ?/);if(2===b.length){var c=b[0],e=b[1];("true"===e||"false"===e)&&(e="true"===e),c in d&&(d[c]=e)}})}"function"==typeof c&&c(d),a.emit("content-settings-changed",[d])}return{parse:b}}]),nextsepta.module("nextsepta").service("cookie",[function(){function a(a,b){return 0===a.indexOf(b)}function b(a,b,c){c=c||{},null===b&&(b="");var d="";if(c.expires){var e;c.expires.getDate?e=c.expires:"number"==typeof c.expires&&(e=new Date,e.setTime(e.getTime()+864e5*c.expires)),e&&(d="; expires="+e.toUTCString())}var f=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"",h=c.secure?"; secure":"";document.cookie=a+"="+encodeURIComponent(b)+d+f+g+h}function c(b){var c;if(document.cookie)for(var d=document.cookie.split(";"),e=0,f=d.length;f>e;e++){var g=$.trim(d[e]);if(a(g,b+"=")){c=decodeURIComponent(g.substring(b.length+1));break}}return c}return function(a,d,e){return"undefined"==typeof d?c(a):(b(a,d,e),void 0)}}]),nextsepta.module("nextsepta").service("data",[function(){function a(a){var b=$.extend({dataType:"json"},a);$.ajax(b)}return{get:function(b,c,d){a({url:b,method:"GET",success:c,error:d})},get_html:function(b,c,d){a({url:b,method:"GET",dataType:"html",success:c,error:d})},post:function(b,c,d,e){a({url:b,method:"POST",data:c,success:d,error:e})}}}]),nextsepta.module("nextsepta").service("geo_locate",[function(){return function(a,b){a=a||nextsepta.noop,b=b||nextsepta.noop,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){c?a(c):b()}):b()}}]),nextsepta.module("nextsepta").service("geo_utils",[function(){function a(a){return a*Math.PI/180}function b(b,c){var d=b[0],e=c[0],f=b[1],g=c[1],h=a(e-d),i=a(g-f),j=Math.pow(Math.sin(h/2),2)+Math.cos(a(d))*Math.cos(a(e))*Math.pow(Math.sin(i/2),2),k=2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j));return 1e3*6371*k}function c(a,c){var d,e,f;return c.forEach(function(c){c.from_stop_point&&(e=b(a,c.from_stop_point),("undefined"==typeof d||d>e)&&(d=e,f=c))}),f}return{point_distance:b,get_closest_trip:c}}]),nextsepta.module("nextsepta").service("history",["module","data","resize","content_settings",function(a,b,c,d){function e(a){$(".js-app-title").text(a.title||q),$(".js-title").text(a.title?a.title+" - "+q:q),l[a.back?"addClass":"removeClass"]("active"),m[a.options?"addClass":"removeClass"]("active"),p[a.footer?"addClass":"removeClass"]("active").removeClass("subways buses trolleys trains").addClass(a.route_type||""),o[a.map?"addClass":"removeClass"]("active"),n[a.map?"hide":"show"]()}function f(a,b){var c="going-left",d="right",e="left",f={},g={},h={};b&&(c="going-right",d="left",e="right"),f[d]="100%",g[e]=0,h[e]="auto";var i=$(".js-content-panel",n).addClass(["current",c].join(" ")),j=$('<div class="content-panel js-content-panel"></div>').addClass(["incoming",d].join(" ")).append(a).appendTo(n);i.animate(f,function(){i.remove()}),j.animate(g,function(){j.removeClass("incoming right left").css(e,"auto")})}function g(b,g,h){d.parse(b,function(d){h&&(history.pushState(d,"",g),a.emit("history-push",[g,b])),e(d),n.is(":visible")&&(c.is_desktop()?n.hide().html('<div class="content-panel js-content-panel">'+b+"</div>").fadeIn("fast"):f(b,!h),k())})}function h(a,c){var d=a.split("?"),e="?"+(d[1]?d[1]+"&":"")+"layout=false";b.get_html(d[0]+e,function(b){c(b,a)})}function i(a,b){l.attr("href",window.location.pathname),b?g(b,a,!0):h(a,function(a,b){g(a,b,!0)})}function j(a){a=a||$("body"),$(".js-nav-link",a).each(function(){$(this).data("nav-link-bound")||$(this).click(function(){var a=$(this).attr("href");return a&&i($(this).attr("href")),!1}).data("nav-link-bound",!0)})}function k(a){a=a||n,nextsepta.module("nextsepta").parse(a),j(a)}if(!window.history)return{};var l,m,n,o,p,q="NEXT|Transit";return $(function(){l=$(".js-nav-link-back").click(function(){return window.history.back(),!1}),m=$(".js-header-options-btn"),p=$(".js-app-footer"),o=$(".js-map"),n=$(".js-content"),q=$("body").attr("data-app-title"),j();var a=!0;$(window).bind("popstate",function(){return a?(a=!1,void 0):(h(window.location.pathname,g),void 0)})}),{parse:function(a){j(a)},push:i,back:function(){window.history.back()}}}]),nextsepta.module("nextsepta").service("map_locate",["module","geo_locate",function(a,b){function c(a,b){e.add_marker(a,b)}function d(){active=!0,b(function(a){c(a.coords.latitude,a.coords.longitude)})}var e;return{locate:d,set_map_ctrl:function(a){e=a}}}]),nextsepta.module("nextsepta").service("map_markers",[function(){function a(a){return a=a||"marker-24",a in i||(i[a]=L.icon({iconUrl:"/images/maki/"+a+".svg",iconSize:[48,48],iconAnchor:[24,24]})),i[a]}function b(b,c,d){d=$.extend({id:"",icon:"",title:"Location",zoom:17,center:!0,message:""},d);var e=L.marker([b,c],{icon:a(d.icon)}).addTo(g);return d.message&&(e.popup=L.popup({autoPan:!1,closeButton:!1,offset:[68,10]}),e.popup.setLatLng([b,c]),e.popup.setContent('<div class="map-marker-info">'+d.message+"</div>"),e.popup.addTo(g)),d.id&&(j[d.id]=e),d.center&&map_ctrl.set_center(b,c,d.zoom),e}function c(a,b,c,d){a in j&&(j[a].setLatLng([b,c]).update(),j[a].popup&&j[a].popup.setLatLng([b,c]),d&&map_ctrl.set_center(b,c,map_ctrl.map.getZoom()))}function d(a){a in j&&g.removeLayer(j[a])}function e(){g.clearLayers(),j={}}function f(){h||(g=L.layerGroup().addTo(map_ctrl.map),h=!0)}var g,h=!1,i={},j={};return{add:b,move:c,remove:d,clear:e,set_map_ctrl:function(a){map_ctrl=a,f()}}}]),nextsepta.module("nextsepta").service("map_routes",["module","data","history","geo_utils",function(a,b,c,d){function e(a,b){var c=q.map.getCenter(),e=[c.lat,c.lng],f=[];a.forEach(function(a){var b=9999;a.paths.forEach(function(a){a.forEach(function(a){var c=d.point_distance(e,a);b>c&&(b=c)})}),f.push({route:a,closest_distance:b})}),f.sort(function(a,b){return a.closest_distance-b.closest_distance});var g=[],h={},i=0;return f.forEach(function(a){b>i&&!h[a.route.id]&&(g.push(a.route),h[a.route.id]=!0,i++)}),g}function f(a){var b=e(a,8);b.forEach(function(a){var b=$("<li />").appendTo(t);$('<a href="/'+a.route_type_slug+"/"+a.slug+'" class="js-nav-link">'+a.route_name+"</a>").css("backgroundColor",a.color).appendTo(b).hover(function(){h(a,!0)},function(){h(a,!1)})})}function g(a,b){a.setStyle({opacity:b?.9:.45})}function h(a,b){a&&a.path_layers&&a.path_layers.forEach(function(a){g(a,b)})}function i(a){var b=[];return a.forEach(function(a){b.push({data:{direction_id:a.direction_id,stop_id:a.stop_id},shape:[a.stop_lat,a.stop_lon]})}),b}function j(a,b,d,e){a.on("click",function(){c.push(b)}).on("mouseover",function(){d(e,!0)}).on("mouseout",function(){d(e,!1)})}function k(a,b){t.empty(),q.clear_vectors(),a.forEach(function(a){a.paths&&(a.path_layers=q.add_vector(a.paths,a.color,.45),a.path_layers.forEach(function(b){j(b,"/"+a.route_type_slug+"/"+a.slug,h,a)})),a.stops&&(a.point_layers=q.add_vector_points(i(a.stops),a.color,.45),a.point_layers.forEach(function(b){j(b,"/"+a.route_type_slug+"/"+a.slug+"/"+b.data.direction_id+"/"+b.data.stop_id,g,b)}))}),b&&(f(a),s.show(),c.parse(s))}function l(a,c){var d=q.map.getBounds(),e=[d._southWest.lng,d._southWest.lat,d._northEast.lng,d._northEast.lat].join(",");b.get("/shapes?bbox="+e+"&stops="+!!c,function(b){b&&b.routes&&k(b.routes,a,c)})}function m(){l(!0,!0)}function n(){l()}function o(a,c,d){b.get(["",a,c,"shape"].join("/"),function(a){k([a]),d&&q.fit_to_last_path()})}function p(){v||(a.on("map-moveend",function(){u&&m()}),s=$('<div class="map-results-list"></div>').hide().appendTo(r),t=$("<ul></ul>").appendTo(s),v=!0)}var q,r,s,t,u=!1,v=!1;return{add:o,add_all:n,nearby:m,set_map_ctrl:function(a,b){q=a,r=b,p()},enable:function(){u=!0},disable:function(){s&&s.hide(),u=!1}}}]),nextsepta.module("nextsepta").service("map_vectors",["module","data",function(a){function b(){var a=h.getLayers();a.length&&g.map.fitBounds(a[a.length-1].getBounds())}function c(a,b,c){var d=[];return a.forEach(function(a){d.push(L.polyline(a,{color:b||"#a33",opacity:c||.65}).addTo(h))}),d}function d(a,b,c){return l=[],a.forEach(function(a){var d=L.circleMarker(a.shape,{color:b||"#3a3",fillColor:"#fff",opacity:c+.2||.85,fillOpacity:c||.65,radius:7,weight:5});d.data=a.data,l.push(d),g.map.getZoom()>=k&&d.addTo(i)}),l}function e(){h.clearLayers(),i.clearLayers()}function f(){j||(h=L.layerGroup().addTo(g.map),i=L.layerGroup().addTo(g.map),a.on("map-moveend",function(){g.map.getZoom()>=k?m&&(l.forEach(function(a){i.addLayer(a)}),m=!1):m||(l.forEach(function(a){i.removeLayer(a)}),m=!0)}),j=!0)}var g,h,i,j=!1,k=15,l=[],m=!1;return{add:c,add_points:d,fit_to_last_path:b,clear:e,set_map_ctrl:function(a){g=a,f()}}}]),nextsepta.module("nextsepta").service("map_vehicles",["data","history",function(a,b){function c(a,c,d,e){function f(a){var b=!1;return e.forEach(function(c){c.vehicle_id===a&&(b=!0)}),b}var g=1===e.length;j.clear_markers(),e.forEach(function(e){var f=e.direction?' <span class="'+p[e.direction]+'"></span>':"",h=e.late<0?"early":"late",i="",k=0;null!==e.late?(k=Math.abs(e.late),i=k+" "+(1===k?"min":"mins")+" "+h):null!==e.offset&&(i=e.offset+" "+("1"===e.offset?"min":"mins")+" ago"+f),j.add_marker(e.lat,e.lng,{id:"vehicle-"+e.vehicle_id,icon:o[e.mode],title:i,center:g,zoom:16,message:i}).on("click",function(){d||b.push("/"+a+"/"+c+"/map?vehicle="+e.vehicle_id)}),n[e.vehicle_id]=e});for(var h in n)f(h)||(j.remove_marker("vehicle-"+h),delete n[h])}function d(b,d,e){a.get("/"+b+"/"+d+"/locations",function(a){if(a&&a.vehicles){var f=[];a.vehicles.forEach(function(a){e&&a.vehicle_id!==e||f.push(a)}),c(b,d,e,f)}})}function e(a,b,c){b&&(l=!0,f(a,b,c))}function f(a,b,c){n={},i=setInterval(function(){d(a,b,c)},3e4),d(a,b,c)}function g(){i&&(clearInterval(i),i=null)}function h(){m||(m=!0)}var i,j,k,l=!1,m=!1,n={},o={tram:"rail-light-24",subway:"rail-underground-24",rail:"rail-24",bus:"bus-24",ferry:"ferry-24",cable:"rail-underground-24",gondola:"rail-underground-24",funicular:"rail-underground-24",unknown:"rail-24"},p={NorthBound:"icon-caret-up",EastBound:"icon-caret-right",SouthBound:"icon-caret-down",WestBound:"icon-caret-left"};return{add_vehicle:e,add_vehicles:e,set_map_ctrl:function(a,b){j=a,k=b,h()},disable:function(){l=!1,g()}}}]),nextsepta.module("nextsepta").service("templates",[function(){function a(a,b){$.ajax({url:a,method:"GET",dataType:"html",success:b})}return{get:a}}]),nextsepta.module("nextsepta",["templates","history","content_settings"]).controller("app",["module","$elem",function(a,b){var c=$(".js-content",b);a.data("route-type",c.attr("data-route-type")),a.data("route-id",c.attr("data-route-id")),a.data("agency-slug",b.attr("data-agency-slug"))}]).run(),nextsepta.module("nextsepta").controller("feedback",["data","$elem",function(a,b){$("#feedback-submit-btn",b).click(function(){$(".error",b).removeClass("error");var c=$("#feedback-name").val(),d=$("#feedback-email").val(),e=$("#feedback-message").val();e?($('<div class="message success"><p>Thanks for your feedback!</p></div>').prependTo(b),a.post("/feedback",{name:c,email:d,message:e})):$("#feedback-message").parents(".control-group").addClass("error")})}]),nextsepta.module("nextsepta").controller("home",["module","cookie","geo_locate","geo_utils","$elem",function(a,b,c,d,e){function f(a){var c,d=b(a);if(d){0===d.indexOf("j:")&&(d=d.replace(/^j:/,""));try{c=JSON.parse(d)}catch(e){}}return c}function g(a,b){c(function(c){var e=[c.coords.latitude,c.coords.longitude],f=d.get_closest_trip(e,a);f&&b(f)},b)}function h(a){$("a",k).attr("href",a.path),$("strong",k).addClass(a.route_type+" "+a.slug).text(a.route_name),$("span",k).text(a.direction_name),k.addClass("show")}var i=f("saved_trips")||[],j=f("recent_trips")||[],k=$(".js-home-recent",e);i.length||(i=j),i.length&&g(i,function(a){a?h(a):h(i[0])})}]),nextsepta.module("nextsepta").controller("map",["module","data","map_locate","map_routes","map_vehicles","map_markers","map_vectors","$elem",function(a,b,c,d,e,f,g,h){function i(b,c,d){var e=m.centers[a.data("agency-slug")]||m.centers.septa;b=b||e.lat,c=c||e.lng,d=d||e.zoom,o.map.setView([b,c],d)}function j(){var a=$(window).height()-$(".js-app-header").outerHeight()-$(".js-app-footer").outerHeight();l.height(a),h.css("top",$(".js-app-header").outerHeight())}function k(){!n&&h.is(":visible")&&(j(),o.map=L.mapbox.map(l.attr("id"),m.tiles_id,{detectRetina:!0,retinaVersion:m.retina_tiles_id}),o.map.on("moveend",function(){a.emit("map-moveend",[])}),f.set_map_ctrl(o,h),g.set_map_ctrl(o,h),c.set_map_ctrl(o,h),d.set_map_ctrl(o,h),e.set_map_ctrl(o,h),i(),n=!0)}var l=$(".js-map-inner",h),m={tiles_id:"reedlauber.map-55lsrr7u",retina_tiles_id:"reedlauber.map-1j4vhxof",centers:{septa:{lat:39.952335,lng:-75.163789,zoom:16},trimet:{lat:45.5197293,lng:-122.673683,zoom:15}}},n=!1,o={};a.on("content-settings-changed",function(a,b){b.map?(k(),f.clear(),g.clear(),d.disable(),e.disable(),b.map_locate?(d.enable(),c.locate()):b.route_type&&b.route_id?(d.add(b.route_type,b.route_id,!b.map_vehicle),b.has_realtime&&e.add_vehicles(b.route_type,b.route_id,b.map_vehicle)):d.add_all()):(d.disable(),e.disable())}),o.set_center=i,o.add_marker=f.add,o.move_marker=f.move,o.remove_marker=f.remove,o.clear_markers=f.clear,o.add_vector=g.add,o.add_vector_points=g.add_points,o.fit_to_last_path=g.fit_to_last_path,o.clear_vectors=g.clear}]),nextsepta.module("nextsepta").controller("options",["$elem",function(a){var b=$(".js-options-recent-trips",a),c=$(".js-options-saved-trips",a);c.on("click",".js-options-delete-saved",function(){var a=$(this),d=a.parent().attr("data-trip-key");$.ajax({url:"/saved-trips/"+d,method:"DELETE",dataType:"json",success:function(){$('[data-trip-key="'+d+'"] .js-options-save-disabled',b).removeClass("js-options-save-disabled disabled").removeAttr("disabled").addClass("btn-add js-options-save-recent").val("Save"),a.parent().remove(),$("li",c).length||$("ul",c).append('<li class="simple-nav-item js-options-saved-trips-none">No saved trips yet.</li>')}})}),b.on("click",".js-options-save-recent",function(){var a=$(this),b=a.parent().attr("data-trip-key");$.ajax({url:"/saved-trips/"+b,method:"POST",dataType:"json",success:function(){a.removeClass("btn-add js-options-save-recent").addClass("js-options-save-disabled disabled").attr("disabled","disabled").val("Saved"),$(".js-options-saved-trips-none",c).remove(),$('<li data-trip-key="'+b+'">'+'<input type="button" class="btn btn-small btn-danger btn-right js-options-delete-saved" value="Delete" />'+"</li>").appendTo($("ul",c)).prepend(a.parent().find("a").clone())}})}),$(".js-options-clear-recent",a).click(function(){$.ajax({url:"/recent-trips/",method:"DELETE",dataType:"json",success:function(){$(".js-options-recent-trips",a).remove()}})})}]),nextsepta.module("nextsepta").controller("trips",["module","templates","data","$elem",function(a,b,c,d){function e(a){if(0>a)return"(GONE)";if(60>a)return"(< 1m)";var b="",c=0;return m.forEach(function(d){a>d.s&&(c=Math.floor(a/d.s),b&&(b+=" "),b+=c+d.l[0],a%=d.s)}),"("+b+")"}function f(){var a=new Date;$.each(n,function(b,c){var d=(c.time-a)/1e3;c.el.html(e(d)),0>d&&c.el.parents(".trip").addClass("gone")}),n.length&&setTimeout(function(){f()},15e3)}function g(a,b){$(".trip",k).each(function(){var c=$(this).attr("data-block-id");if(c&&c in o){var d=o[c],e=["",a,b,"map"].join("/")+"?vehicle="+d.vehicle_id;$(this).addClass("has-vehicle"),$(".icon-map-marker",this).attr("href",e)}})}function h(a,b){b&&c.get(["",a,b,"locations"].join("/"),function(c){o={},c&&c.vehicles&&c.vehicles.forEach(function(a){o[a.block_id]=a}),g(a,b)})}function i(a,c,d,e){d in l?e(l[d]):b.get(a.attr("href")+"&layout=false&itemsonly=true",function(a){if(a=$.trim(a||"")){if($("<ul>"+a+"</ul>"),c){var b=$("li",k).length;k.append(a),l[d]=$("li:eq("+b+")",k)}else k.prepend(a),l[d]=$("li:first",k),k.scrollTo(l[j]);e(l[d])}})}var j="0",k=$(".js-trips-list",d),l={0:$("li:first",k)},m=[{l:"week",s:604800},{l:"day",s:86400},{l:"hr",s:3600},{l:"min",s:60}],n=[],o={};k.height(k.outerHeight()),$(".js-trips-prev, .js-trips-next",d).click(function(){var a=$(this).hasClass("js-trips-next"),b=$(this).attr("href").replace("?offset=",""),c=parseInt(b,10);return(c||0===c)&&i($(this),a,b,function(){k.scrollTo(l[b],500),j=b,$(".js-trips-prev",d).attr("href","?offset="+(c-5)),$(".js-trips-next",d).attr("href","?offset="+(c+5))}),!1}),$(".trip").each(function(){var a=$(this).attr("data-departure-time"),b=$(".trip-from-now",this);if(a){var c=a.split(/[- :]/),d=new Date(c[0],c[1]-1,c[2],c[3],c[4],"00");d&&n.push({time:d,el:b})}}),a.on("content-settings-changed",function(a,b){b.has_realtime&&h(b.route_type,b.route_id),b.all_trips||f()})}]);